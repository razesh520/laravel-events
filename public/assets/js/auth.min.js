/**
 * Authentication JS
 * Description : Authentication Javascript file of the Application.
 * 
 * @copyright (c) 2023 SurazDott
 */

!(function ($) {

    "use strict";

    var baseUrl = $("meta[name='base-url']").attr("content") || null;
    var csrfToken = $("meta[name='csrf-token']").attr("content") || null;

    var Auth = function () {};

    /**
     * Dark Mode enable and disable
     */
    Auth.prototype.darkMode = function () {
        const darkModeCheckbox = $("#darkMode");
        let darkMode = localStorage.getItem("darkmode");

        darkModeCheckbox.on("change", function () {
            const mode = this.checked;

            $("html").attr("data-bs-theme", mode ? "dark" : "light");
            localStorage.setItem('darkmode', mode);
        });

        if (darkMode === "true" || darkMode === "false") {
            darkModeCheckbox.prop("checked", darkMode === "true");
            $("html").attr("data-bs-theme", darkMode === "true" ? "dark" : "light");
        }
    };

    /**
     * Mobile number input mask
     */
    Auth.prototype.mobileInputMask = function () {
        $("#mobile").inputmask("9999999999");
    }

    /**
     * OTP code input mask
     */
    Auth.prototype.OTPInputMask = function () {
        $("#otp_code").inputmask("999999");
    }

    /**
     * Show passwword in login page
     */
    Auth.prototype.showPassword = function () {
        $(document).on("click", "#password-show", function () {
            $(this).find("i").toggleClass("mdi-eye-outline mdi-eye-off-outline");

            var input = $("#password");

            input.attr("type") === "password" ?
                input.attr("type", "text") :
                input.attr("type", "password")
        });
    };

    /**
     * Logging In
     */
    Auth.prototype.loggingIn = function () {
        $("#login").click(function() {
            if ($("#email").val() || $("#mobile").val() && $("#password").val()) {
                $(this).text("Log In...");
                $(this).prepend("<i class='fas fa-circle-notch fa-spin me-1'></i>");
            }
        });
    };

    /**
     * Add star in required form field.
     */
    Auth.prototype.addStarInField = function () {
        $("input[required]:not([type='radio']):not([type='checkbox']), select:required, textarea:required").each(function (e) {
            $(this).closest(".row, .mb-3").find("label").addClass("required");
        });
    }

    /**
     * Needs form validation.
     */
    Auth.prototype.needsFormValidation = function() {
        $(".needs-validation").each(function() {
            $(this).submit(function(event) {
                if (! this.checkValidity()) {
                    $(this).addClass("was-validated");

                    event.preventDefault();
                    event.stopPropagation();
                }
                
            });
        });
    }

    /**
     * Close bootstrap alert.
     */
    Auth.prototype.closeAlert = function() {
        setTimeout(function () {
            $(".alert:not(.alert-dismissible)").fadeOut("normal", function() {
                $(this).remove();
            });
        }, 9000);
    }

    /**
     * Register functions
     */
    $.Auth = new Auth();

    $.Auth.darkMode();
    $.Auth.showPassword();
    $.Auth.loggingIn();
    $.Auth.mobileInputMask();
    $.Auth.OTPInputMask();
    $.Auth.addStarInField();
    $.Auth.needsFormValidation();
    $.Auth.closeAlert();

})(jQuery);
